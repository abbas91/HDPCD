
Create hfs directory for PIG :

hadoop fs -mkdir /user/pig_demo

Create pig_word_count_demo.txt with some text. Transfer it to /user/pig_demo

hadoop fs -put pig_word_count_demo.txt /user/pig_demo

1) pig_demo.pig:

load_data = load '/user/pig_demo/pig_word_count_demo.txt’;
dump load_data;

2) word_count.pig

lines = LOAD '/user/pig_demo/pig_word_count_demo.txt’ using PigStorage() AS (line:chararray);
words = FOREACH lines GENERATE FLATTEN(TOKENIZE(line)) AS word;
grouped = GROUP words by word;
wordCount = FOREACH grouped GENERATE group, COUNT(words);
DUMP wordCount;

3) Load data without a schema :->
  
   A = LOAD ‘/user/sqoop/all_tables/departments’ USING PigStorage(‘,’);

4) Load data with a schema :->
  
   A = LOAD ‘/user/sqoop/all_tables/departments’ USING PigStorage(‘,’) AS (department_id:int, department_name:chararray);

5) Load data from Hive :->
   
   Important Launch pig with Parameter  -useHcatalog :-> pig -useHCatalog
   customerDetails = LOAD 'xademo.customer_details' USING org.apache.hive.hcatalog.pig.HCatLoader();
   DUMP customerDetails;

6) Transform to match Hive schema :->
   
   First get the hfs location of a table using :
   DESCRIBE FORMATTED customer_details; -> Also get the delimiter by verifying field.delim Parameter
   Location:           	hdfs://sandbox.hortonworks.com:8020/apps/hive/warehouse/xademo.db/customer_details
   field.delim         	|
 
   customer_details = LOAD 'hdfs://sandbox.hortonworks.com:8020/apps/hive/warehouse/xademo.db/customer_details' USING PigStorage('|') AS (phone_number:chararray,plan:chararray,rec_date:chararray,status:chararray,balance:chararray,imei:chararray,region:chararray);
   

7) Grouping :->
   
   customer_details_hive = LOAD 'xademo.customer_details' USING org.apache.hive.hcatalog.pig.HCatLoader();
   customer_details_hive_noheader = FILTER customer_details_hive BY phone_number != 'PHONE_NUM';
   customer_details_group_all = GROUP customer_details_hive_noheader ALL;
   customer_details_count = FOREACH customer_details_group_all GENERATE COUNT_STAR(customer_details_hive_noheader) AS cnt;

   —To Filter out columns with NULLs
   customer_details_hive_no_null = FILTER customer_details_hive_noheader BY imei != ‘’;
   customer_details_hive_no_null_grouped = GROUP customer_details_hive_no_null ALL;
   customer_details_hive_no_null_count = FOREACH customer_details_hive_no_null_grouped GENERATE COUNT_STAR(customer_details_hive_no_null) AS cnt;
   
   


